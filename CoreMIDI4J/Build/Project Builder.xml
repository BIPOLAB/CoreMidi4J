<project name="CoreMIDI4J SPI Builder">

  <property name="src.dir" value="../src"/>
  <property name="classes.dir" value = "../bin"/>
  <property name="release.dir" value = "../Build/Release"/>
  <property name="bootstrap.jar" value="jre17rt.jar"/>

  <target name="clean">
    <delete dir="${classes.dir}"/>
  </target>

  <target name="checkRT">
    <available file="${bootstrap.jar}" property="rt.found"/>
    <fail unless="rt.found"
          message="In order to compile CoreMIDI4J you must place a copy of the Java 7 rt.jar file, named ${bootstrap.jar} in the same directory as Project Builder.xml."/>
  </target>

  <target name="compile" depends="checkRT">
    <echo>Compiling ${src.dir} using source=1.7 and bootclasspath=${bootstrap.jar}</echo>
    <mkdir dir="${classes.dir}"/>
    <javac includeantruntime="false" srcdir="${src.dir}" destdir="${classes.dir}"
           source="1.7" target="1.7" bootclasspath="${bootstrap.jar}" />
  </target>

  <target name="MakeJar">
    <echo>Creating CoreMidi4J.jar from contents of bin directory.</echo>
    <delete file="${release.dir}/CoreMIDI4J.jar"/>
    <jar destfile="${release.dir}/CoreMIDI4J.jar"
         basedir="${classes.dir}">
      <service type="javax.sound.midi.spi.MidiDeviceProvider"
               provider="uk.co.xfactorylibrarians.coremidi4j.CoreMidiDeviceProvider"/>
    </jar>
  </target>
  
  <target name="MakeZip">
    <echo>Creating CoreMidi4J.zip from any existing jar and dylib files.</echo>
    <zip destfile="${release.dir}/CoreMidi4J.zip"
         basedir="${release.dir}"
         includes="**/*.jar,**/*.dylib"
         excludes="**/*.zip"/>
  </target>

</project>
